<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Rounds">
<meta name="theme-color" content="#0d0d0d">
<title>Rounds</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@700;800&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#0d0d0d;--bg2:#141414;--surf:#1a1a1a;--surf2:#222;--surf3:#2a2a2a;
  --brd:#2e2e2e;--brd2:#3a3a3a;--tx:#f2efe9;--tx2:#888882;--tx3:#555550;
  --am:#f59e0b;--am-d:rgba(245,158,11,.12);--am-g:rgba(245,158,11,.25);
  --or:#ea580c;--gn:#22c55e;--gn-d:rgba(34,197,94,.12);
  --rd:#ef4444;--rd-d:rgba(239,68,68,.12);
  --r:14px;--rl:20px;--rxl:28px;
  --st:env(safe-area-inset-top,0px);--sb:env(safe-area-inset-bottom,0px);
  --nh:64px;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
html{scroll-behavior:smooth;height:100%}
body{font-family:'Outfit',sans-serif;background:var(--bg);color:var(--tx);min-height:100%;font-size:15px;line-height:1.55;-webkit-font-smoothing:antialiased;overflow-x:hidden}

/* SCREENS */
.sc{display:none}
.sc.on{display:flex;flex-direction:column;min-height:100dvh}

/* LOADING */
#ld{position:fixed;inset:0;background:var(--bg);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:24px;z-index:9999}
.ll{font-family:'Syne',sans-serif;font-size:2.8rem;font-weight:800;letter-spacing:-.04em}
.ll b{color:var(--am)}
.sp{width:24px;height:24px;border:2.5px solid var(--brd2);border-top-color:var(--am);border-radius:50%;animation:spin .7s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}

/* AUTH */
#sa{background:var(--bg);justify-content:center;align-items:center;padding:32px 20px;position:relative;overflow:hidden;min-height:100dvh}
.ag{position:absolute;inset:0;pointer-events:none;background:radial-gradient(600px circle at 20% 0%,rgba(245,158,11,.07) 0%,transparent 60%),radial-gradient(400px circle at 85% 100%,rgba(234,88,12,.05) 0%,transparent 50%)}
.ai{width:100%;max-width:400px;position:relative;z-index:1}
.ab{text-align:center;margin-bottom:36px}
.abl{font-family:'Syne',sans-serif;font-size:2.6rem;font-weight:800;letter-spacing:-.04em;line-height:1}
.abl b{color:var(--am)}
.abs{color:var(--tx2);font-size:.88rem;margin-top:6px}
.abox{background:var(--surf);border:1px solid var(--brd);border-radius:var(--rxl);padding:28px 24px;box-shadow:0 32px 64px rgba(0,0,0,.5)}
.seg{display:flex;background:var(--bg2);border-radius:10px;padding:3px;margin-bottom:24px;gap:3px}
.sb{flex:1;padding:9px;border:none;background:none;color:var(--tx2);font-family:'Outfit',sans-serif;font-size:.88rem;font-weight:600;border-radius:8px;cursor:pointer;transition:all .2s}
.sb.on{background:var(--am);color:#000}
.fi{margin-bottom:14px}
.fi label{display:block;font-size:.73rem;font-weight:700;color:var(--tx2);text-transform:uppercase;letter-spacing:.07em;margin-bottom:6px}
.fi input,.inp{width:100%;background:var(--bg2);border:1.5px solid var(--brd);border-radius:var(--r);padding:13px 15px;font-family:'Outfit',sans-serif;font-size:.95rem;color:var(--tx);transition:border-color .15s,box-shadow .15s;outline:none}
.fi input:focus,.inp:focus{border-color:var(--am);box-shadow:0 0 0 3px var(--am-d)}
.fi input::placeholder,.inp::placeholder{color:var(--tx3)}
.er{color:var(--rd);font-size:.82rem;margin-top:10px;text-align:center;display:none;padding:8px 12px;background:var(--rd-d);border-radius:8px}

/* BUTTONS */
.btn{display:inline-flex;align-items:center;justify-content:center;gap:6px;padding:13px 20px;border-radius:var(--r);border:none;cursor:pointer;font-family:'Outfit',sans-serif;font-size:.95rem;font-weight:600;transition:all .15s;text-decoration:none;white-space:nowrap}
.btn:active{transform:scale(.96)}
.bw{width:100%}
.ba{background:var(--am);color:#000}
.ba:hover{background:#fbbf24}
.bg_{background:var(--surf2);color:var(--tx);border:1.5px solid var(--brd)}
.bg_:hover{border-color:var(--am);color:var(--am)}
.br_{background:var(--rd-d);color:var(--rd);border:1.5px solid rgba(239,68,68,.2)}
.bgn{background:var(--gn-d);color:var(--gn);border:1.5px solid rgba(34,197,94,.2)}
.bsm{padding:7px 13px;font-size:.8rem;border-radius:9px}
.bxs{padding:5px 10px;font-size:.75rem;border-radius:7px}

/* APP SHELL */
#sap{background:var(--bg)}
.ah{position:sticky;top:0;z-index:100;background:rgba(13,13,13,.92);backdrop-filter:blur(24px);-webkit-backdrop-filter:blur(24px);border-bottom:1px solid var(--brd);padding:calc(var(--st) + 12px) 18px 12px;display:flex;align-items:center;justify-content:space-between}
.lo{font-family:'Syne',sans-serif;font-size:1.5rem;font-weight:800;letter-spacing:-.04em}
.lo b{color:var(--am)}
.hr{display:flex;align-items:center;gap:10px}
.av{width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,var(--am) 0%,var(--or) 100%);display:flex;align-items:center;justify-content:center;font-size:.78rem;font-weight:800;color:#000;cursor:pointer;flex-shrink:0;border:2px solid transparent;transition:border-color .2s}
.av:hover{border-color:var(--am)}

/* BOTTOM NAV */
.bn{position:fixed;bottom:0;left:0;right:0;z-index:100;background:rgba(20,20,20,.96);backdrop-filter:blur(24px);-webkit-backdrop-filter:blur(24px);border-top:1px solid var(--brd);display:flex;padding:6px 0 calc(var(--sb) + 4px)}
.nb{flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;padding:6px 0;border:none;background:none;color:var(--tx3);font-family:'Outfit',sans-serif;font-size:.67rem;font-weight:600;cursor:pointer;transition:color .15s;position:relative}
.nb .ic{font-size:1.25rem;line-height:1;transition:transform .2s}
.nb.on{color:var(--am)}
.nb.on .ic{transform:scale(1.1)}
.nbd{position:absolute;top:4px;right:calc(50% - 18px);background:var(--am);color:#000;font-size:.58rem;font-weight:800;min-width:15px;height:15px;border-radius:8px;display:flex;align-items:center;justify-content:center;padding:0 3px}

/* TAB VIEWS */
.tv{display:none;padding:16px 16px calc(var(--nh) + var(--sb) + 16px);min-height:calc(100dvh - 64px)}
.tv.on{display:block}
#tv-chat{padding:0;display:none;flex-direction:column;height:calc(100dvh - 64px)}
#tv-chat.on{display:flex}

/* TYPOGRAPHY */
.pt{font-family:'Syne',sans-serif;font-size:1.5rem;font-weight:800;letter-spacing:-.02em;margin-bottom:4px}
.ps{font-size:.83rem;color:var(--tx2);margin-bottom:20px}
.sl{font-size:.7rem;font-weight:700;text-transform:uppercase;letter-spacing:.09em;color:var(--tx3);margin:0 0 8px}
.dv{height:1px;background:var(--brd);margin:16px 0}

/* CARD */
.card{background:var(--surf);border:1px solid var(--brd);border-radius:var(--rl);padding:16px;margin-bottom:10px}

/* EVENT CARD */
.evc{background:var(--surf);border:1px solid var(--brd);border-radius:var(--rxl);overflow:hidden;margin-bottom:14px;transition:border-color .2s,transform .15s}
.evc:active{transform:scale(.99)}
.evh{padding:18px 18px 14px;background:linear-gradient(135deg,var(--am-d) 0%,rgba(234,88,12,.06) 100%);border-bottom:1px solid var(--brd);position:relative}
.evh::before{content:'üç∫';position:absolute;right:16px;top:14px;font-size:1.8rem;opacity:.5}
.evn{font-family:'Syne',sans-serif;font-size:1.15rem;font-weight:700;margin-bottom:8px;letter-spacing:-.01em}
.evcs{display:flex;flex-wrap:wrap;gap:6px}
.evch{display:inline-flex;align-items:center;gap:4px;background:var(--surf2);border:1px solid var(--brd2);border-radius:20px;padding:4px 10px;font-size:.75rem;color:var(--tx2);font-weight:500}
.evb{padding:14px 18px}
.evd{font-size:.85rem;color:var(--tx2);margin-bottom:14px;line-height:1.6}
.rvw{display:flex;gap:8px;margin-bottom:14px}
.rv{flex:1;padding:10px 6px;border-radius:11px;border:1.5px solid var(--brd2);background:var(--surf2);color:var(--tx2);font-family:'Outfit',sans-serif;font-size:.78rem;font-weight:600;cursor:pointer;transition:all .15s;text-align:center}
.rv:active{transform:scale(.94)}
.rv.yes.on{background:var(--gn-d);border-color:var(--gn);color:var(--gn)}
.rv.maybe.on{background:var(--am-d);border-color:var(--am);color:var(--am)}
.rv.no.on{background:var(--rd-d);border-color:var(--rd);color:var(--rd)}
.evf{display:flex;align-items:center;justify-content:space-between}
.evby{font-size:.75rem;color:var(--tx3)}

/* FAB */
.fab{position:fixed;right:20px;bottom:calc(var(--nh) + var(--sb) + 14px);width:52px;height:52px;border-radius:50%;background:var(--am);color:#000;border:none;font-size:1.5rem;cursor:pointer;box-shadow:0 8px 24px var(--am-g);display:none;align-items:center;justify-content:center;z-index:90;transition:transform .15s,box-shadow .15s}
.fab.show{display:flex}
.fab:active{transform:scale(.9);box-shadow:0 4px 12px var(--am-g)}

/* MODALS */
.ov{position:fixed;inset:0;z-index:200;background:rgba(0,0,0,.75);backdrop-filter:blur(6px);-webkit-backdrop-filter:blur(6px);display:none;align-items:flex-end;justify-content:center}
.ov.open{display:flex}
.ov.center{align-items:center;padding:20px}
.sh{background:var(--surf);border-radius:var(--rxl) var(--rxl) 0 0;border:1px solid var(--brd);border-bottom:none;width:100%;max-width:500px;max-height:92dvh;overflow-y:auto;padding:20px 20px calc(20px + var(--sb));animation:slideUp .28s cubic-bezier(.32,.72,0,1)}
@keyframes slideUp{from{transform:translateY(100%);opacity:0}to{transform:translateY(0);opacity:1}}
.hn{width:36px;height:4px;background:var(--brd2);border-radius:2px;margin:0 auto 18px}
.mt{font-family:'Syne',sans-serif;font-size:1.2rem;font-weight:700;margin-bottom:18px;letter-spacing:-.02em}

/* INPUTS */
.iw{margin-bottom:12px}
.il{display:block;font-size:.72rem;font-weight:700;color:var(--tx2);text-transform:uppercase;letter-spacing:.07em;margin-bottom:6px}
textarea.inp{resize:none;line-height:1.6}
input[type="datetime-local"].inp{color-scheme:dark}

/* CHAT */
.cs{display:flex;height:100%;overflow:hidden;position:relative;width:100%}
.cl{width:100%;flex-shrink:0;display:flex;flex-direction:column;border-right:1px solid var(--brd);overflow:hidden}
.clh{padding:16px;border-bottom:1px solid var(--brd);display:flex;align-items:center;justify-content:space-between}
.clt{font-family:'Syne',sans-serif;font-size:1.1rem;font-weight:700}
.cls{flex:1;overflow-y:auto;padding:8px}
.cri{display:flex;align-items:center;gap:11px;padding:11px 10px;border-radius:var(--r);cursor:pointer;transition:background .12s;position:relative}
.cri:hover,.cri.active{background:var(--surf2)}
.cricon{width:44px;height:44px;border-radius:50%;flex-shrink:0;background:linear-gradient(135deg,var(--am-d),rgba(234,88,12,.15));border:1.5px solid var(--brd2);display:flex;align-items:center;justify-content:center;font-size:1.1rem}
.cricon.dm{background:linear-gradient(135deg,var(--am),var(--or));font-size:.75rem;font-weight:800;color:#000}
.crinfo{flex:1;min-width:0}
.crn{font-weight:600;font-size:.92rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.crp{font-size:.78rem;color:var(--tx2);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-top:1px}
.crm{display:flex;flex-direction:column;align-items:flex-end;gap:4px}
.crt{font-size:.7rem;color:var(--tx3)}
.cru{background:var(--am);color:#000;font-size:.62rem;font-weight:800;min-width:18px;height:18px;border-radius:9px;display:flex;align-items:center;justify-content:center;padding:0 4px}

/* Chat room */
.crp_{display:none;flex-direction:column;height:100%;position:absolute;inset:0;background:var(--bg);z-index:10}
.crp_.open{display:flex}
.crph{padding:12px 14px;background:rgba(13,13,13,.95);backdrop-filter:blur(20px);border-bottom:1px solid var(--brd);display:flex;align-items:center;gap:10px;flex-shrink:0}
.cb{background:none;border:none;color:var(--tx2);font-size:1.3rem;cursor:pointer;padding:4px}
.crhi{flex:1}
.crhn{font-weight:700;font-size:.95rem}
.crhs{font-size:.75rem;color:var(--tx2)}
.cms{flex:1;overflow-y:auto;padding:14px;display:flex;flex-direction:column;gap:10px}
.mr{display:flex;gap:8px;align-items:flex-end}
.mr.me{flex-direction:row-reverse}
.ma{width:26px;height:26px;border-radius:50%;background:linear-gradient(135deg,var(--am),var(--or));display:flex;align-items:center;justify-content:center;font-size:.6rem;font-weight:800;color:#000;flex-shrink:0}
.mc{max-width:72%}
.ms{font-size:.7rem;color:var(--tx2);font-weight:600;margin-bottom:3px}
.mb{background:var(--surf2);border:1px solid var(--brd);border-radius:16px 16px 16px 4px;padding:9px 13px;font-size:.9rem;line-height:1.5;word-break:break-word}
.mr.me .mb{background:var(--am);color:#000;border-radius:16px 16px 4px 16px;border-color:var(--am)}
.mti{font-size:.65rem;color:var(--tx3);margin-top:3px}
.mr.me .mti{text-align:right;color:rgba(0,0,0,.45)}
.cib{padding:10px 14px;background:var(--surf);border-top:1px solid var(--brd);display:flex;gap:8px;align-items:center;padding-bottom:calc(10px + var(--sb));flex-shrink:0}
.ci{flex:1;background:var(--surf2);border:1.5px solid var(--brd);border-radius:22px;padding:10px 16px;font-family:'Outfit',sans-serif;font-size:.92rem;color:var(--tx);outline:none;transition:border-color .15s}
.ci:focus{border-color:var(--am)}
.ci::placeholder{color:var(--tx3)}
.sndb{width:40px;height:40px;border-radius:50%;background:var(--am);border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:.9rem;flex-shrink:0;transition:transform .15s}
.sndb:active{transform:scale(.88)}

/* FRIENDS */
.fri{display:flex;align-items:center;gap:12px;padding:13px 14px;background:var(--surf);border:1px solid var(--brd);border-radius:var(--rl);margin-bottom:8px;transition:border-color .15s}
.fra{width:42px;height:42px;border-radius:50%;background:linear-gradient(135deg,var(--am),var(--or));display:flex;align-items:center;justify-content:center;font-size:.82rem;font-weight:800;color:#000;flex-shrink:0}
.frin{flex:1;min-width:0}
.frn{font-weight:600;font-size:.92rem}
.fre{font-size:.77rem;color:var(--tx2);margin-top:1px}
.frac{display:flex;gap:6px}
.tag{display:inline-flex;align-items:center;padding:4px 10px;border-radius:20px;font-size:.72rem;font-weight:700}
.tgg{background:var(--gn-d);color:var(--gn)}
.tga{background:var(--am-d);color:var(--am)}

/* MAP */
#mf{width:100%;height:280px;border-radius:var(--rl);overflow:hidden;border:1px solid var(--brd);background:var(--surf2);margin-bottom:12px}
#mf iframe{width:100%;height:100%;border:0;border-radius:var(--rl)}
.me_{width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:8px;color:var(--tx2);font-size:.85rem}
.me_ .ei{font-size:2.5rem}

/* PHOTOS */
.pg{display:grid;grid-template-columns:repeat(3,1fr);gap:3px;border-radius:var(--r);overflow:hidden}
.pc{aspect-ratio:1;overflow:hidden;cursor:pointer;background:var(--surf2)}
.pc img{width:100%;height:100%;object-fit:cover;transition:transform .2s}
.pc:hover img{transform:scale(1.05)}

/* PROFILE */
.ph{display:flex;align-items:center;gap:16px;margin-bottom:20px}
.pa{width:58px;height:58px;border-radius:50%;background:linear-gradient(135deg,var(--am),var(--or));display:flex;align-items:center;justify-content:center;font-size:1.3rem;font-weight:800;color:#000}
.pn{font-family:'Syne',sans-serif;font-size:1.2rem;font-weight:700}
.pe{font-size:.82rem;color:var(--tx2);margin-top:2px}

/* TOAST */
.toast{position:fixed;top:calc(var(--st) + 70px);left:50%;transform:translateX(-50%) translateY(-8px);background:var(--surf3);color:var(--tx);border:1px solid var(--brd2);padding:10px 18px;border-radius:50px;font-size:.84rem;font-weight:500;opacity:0;transition:all .25s;pointer-events:none;z-index:9998;white-space:nowrap;box-shadow:0 8px 32px rgba(0,0,0,.4)}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

/* EMPTY */
.empty{text-align:center;padding:48px 20px;color:var(--tx2)}
.empty .ei{font-size:2.8rem;margin-bottom:12px}
.empty p{font-size:.87rem;line-height:1.7}

/* SEARCH */
.srch{position:relative;margin-bottom:14px}
.srch input{width:100%;background:var(--surf);border:1.5px solid var(--brd);border-radius:var(--r);padding:11px 14px 11px 40px;font-family:'Outfit',sans-serif;font-size:.9rem;color:var(--tx);outline:none;transition:border-color .15s}
.srch input:focus{border-color:var(--am)}
.srch input::placeholder{color:var(--tx3)}
.srch::before{content:'üîç';position:absolute;left:12px;top:50%;transform:translateY(-52%);font-size:.85rem;pointer-events:none}

/* GROUP PICKER */
.mpc{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:12px;min-height:36px}
.mch{display:inline-flex;align-items:center;gap:5px;background:var(--am-d);border:1px solid var(--am);color:var(--am);border-radius:20px;padding:4px 10px;font-size:.78rem;font-weight:600;cursor:pointer}
.fpl{display:flex;flex-direction:column;gap:6px;max-height:200px;overflow-y:auto}
.fpi{display:flex;align-items:center;gap:10px;padding:9px 10px;border-radius:var(--r);border:1.5px solid var(--brd);background:var(--surf2);cursor:pointer;transition:all .12s}
.fpi.sel{border-color:var(--am);background:var(--am-d)}
.fpia{width:30px;height:30px;border-radius:50%;background:linear-gradient(135deg,var(--am),var(--or));display:flex;align-items:center;justify-content:center;font-size:.65rem;font-weight:800;color:#000;flex-shrink:0}
.fpinm{font-size:.88rem;font-weight:500;flex:1}
.fpck{color:var(--am);font-size:1rem}
</style>
</head>
<body>

<div id="ld"><div class="ll">Rounds<b>.</b></div><div class="sp"></div></div>

<!-- AUTH -->
<div class="sc" id="sa">
  <div class="ag"></div>
  <div class="ai">
    <div class="ab"><div class="abl">Rounds<b>.</b></div><div class="abs">Afspreken met je crew üç∫</div></div>
    <div class="abox">
      <div class="seg">
        <button class="sb on" onclick="authTab('login')">Inloggen</button>
        <button class="sb" onclick="authTab('register')">Registreren</button>
      </div>
      <div id="ap-login">
        <div class="fi"><label>E-mailadres</label><input type="email" id="li-em" placeholder="jij@email.com" autocomplete="email"></div>
        <div class="fi"><label>Wachtwoord</label><input type="password" id="li-pw" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password"></div>
        <button class="btn ba bw" onclick="doLogin()">Inloggen ‚Üí</button>
        <div class="er" id="li-er"></div>
      </div>
      <div id="ap-reg" style="display:none">
        <div class="fi"><label>Naam</label><input type="text" id="rg-nm" placeholder="Quinten" autocomplete="name"></div>
        <div class="fi"><label>E-mailadres</label><input type="email" id="rg-em" placeholder="jij@email.com" autocomplete="email"></div>
        <div class="fi"><label>Wachtwoord</label><input type="password" id="rg-pw" placeholder="Min. 6 tekens" autocomplete="new-password"></div>
        <button class="btn ba bw" onclick="doRegister()">Account aanmaken ‚Üí</button>
        <div class="er" id="rg-er"></div>
      </div>
    </div>
  </div>
</div>

<!-- APP -->
<div class="sc" id="sap">
  <header class="ah">
    <div class="lo">Rounds<b>.</b></div>
    <div class="hr"><div class="av" id="hav" onclick="openProfile()">?</div></div>
  </header>

  <!-- HOME -->
  <div class="tv on" id="tv-home">
    <div class="pt" id="greet">Hey üëã</div>
    <div class="ps">Wat staat er op de planning?</div>
    <div class="sl">Aankomende events</div>
    <div id="evl"><div class="empty"><div class="ei">üç∫</div><p>Nog geen events.<br>Tik + om er een aan te maken!</p></div></div>
  </div>

  <!-- CHAT -->
  <div class="tv" id="tv-chat">
    <div class="cs">
      <div class="cl" id="clp">
        <div class="clh"><div class="clt">Gesprekken</div><button class="btn bg_ bsm" onclick="openNewGroup()">+ Groep</button></div>
        <div class="cls" id="crl"><div class="empty" style="padding:30px 10px"><div class="ei" style="font-size:2rem">üí¨</div><p>Voeg vrienden toe<br>om te chatten!</p></div></div>
      </div>
      <div class="crp_" id="crpp">
        <div class="crph">
          <button class="cb" onclick="closeRoom()">‚Äπ</button>
          <div class="crhi"><div class="crhn" id="rn">‚Äî</div><div class="crhs" id="rs">‚Äî</div></div>
        </div>
        <div class="cms" id="cmsgs"></div>
        <div class="cib">
          <input class="ci" id="mi" placeholder="Stuur een bericht..." onkeydown="if(event.key==='Enter')sendMsg()">
          <button class="sndb" onclick="sendMsg()">‚û§</button>
        </div>
      </div>
    </div>
  </div>

  <!-- MAP -->
  <div class="tv" id="tv-map">
    <div class="pt">Meeting Point</div>
    <div class="ps">Stel de locatie in voor iedereen</div>
    <div id="mf"><div class="me_"><div class="ei">üìç</div><div>Nog geen locatie</div></div></div>
    <div id="slc" style="display:none" class="card">
      <div class="sl">Huidig meeting point</div>
      <div style="font-weight:700;font-size:1rem;margin-bottom:4px" id="sln"></div>
      <div style="font-size:.8rem;color:var(--tx2);margin-bottom:12px" id="slm"></div>
      <a id="slg" href="#" target="_blank" class="btn bg_ bsm">üó∫Ô∏è Open in Google Maps</a>
    </div>
    <div class="card">
      <div class="sl" style="margin-bottom:10px">Nieuwe locatie instellen</div>
      <div class="iw"><label class="il">Naam</label><input class="inp" id="ln" placeholder="bijv. Caf√© De Kroon, Mechelen"></div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px" class="iw">
        <div><label class="il">Breedtegraad</label><input class="inp" type="number" id="ll" placeholder="51.0259" step=".0001"></div>
        <div><label class="il">Lengtegraad</label><input class="inp" type="number" id="llg" placeholder="4.4776" step=".0001"></div>
      </div>
      <button class="btn ba bw" onclick="saveLoc()">üìç Opslaan</button>
    </div>
  </div>

  <!-- FRIENDS -->
  <div class="tv" id="tv-friends">
    <div class="pt">Vrienden</div>
    <div class="ps">Vind en beheer je crew</div>
    <div class="srch"><input type="email" id="frs" placeholder="Zoek op e-mailadres..."></div>
    <button class="btn ba bw" style="margin-bottom:20px" onclick="searchFriend()">Vriend zoeken</button>
    <div id="frreq" style="display:none">
      <div class="sl">Verzoeken üîî</div>
      <div id="frrl"></div>
      <div class="dv"></div>
    </div>
    <div class="sl">Mijn vrienden</div>
    <div id="frl"><div class="empty"><div class="ei">üë•</div><p>Nog geen vrienden.<br>Zoek iemand op via e-mail!</p></div></div>
  </div>

  <!-- PHOTOS -->
  <div class="tv" id="tv-photos">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px">
      <div><div class="pt">Foto's</div><div class="ps" style="margin:0">Gedeeld door de crew</div></div>
      <label style="cursor:pointer"><input type="file" accept="image/*" id="phi" style="display:none" onchange="uploadPhoto(this)"><span class="btn ba bsm">+ Foto</span></label>
    </div>
    <div class="pg" id="pgr"></div>
    <div id="phem" class="empty"><div class="ei">üì∏</div><p>Nog geen foto's.<br>Voeg de eerste toe!</p></div>
  </div>

  <nav class="bn">
    <button class="nb on" id="nb-home" onclick="goTab('home')"><span class="ic">üè†</span>Home</button>
    <button class="nb" id="nb-chat" onclick="goTab('chat')"><span class="ic">üí¨</span>Chat<span class="nbd" id="cbd" style="display:none">0</span></button>
    <button class="nb" id="nb-map" onclick="goTab('map')"><span class="ic">üìç</span>Map</button>
    <button class="nb" id="nb-friends" onclick="goTab('friends')"><span class="ic">üë•</span>Vrienden</button>
    <button class="nb" id="nb-photos" onclick="goTab('photos')"><span class="ic">üì∏</span>Foto's</button>
  </nav>
</div>

<button class="fab" id="fab" onclick="openCreateEvent()">+</button>

<!-- CREATE EVENT -->
<div class="ov" id="mo-ev">
  <div class="sh">
    <div class="hn"></div>
    <div class="mt">üç∫ Nieuw event</div>
    <div class="iw"><label class="il">Naam *</label><input class="inp" id="en" placeholder="bijv. Vrijdagavond uit!"></div>
    <div class="iw"><label class="il">Datum & tijd *</label><input class="inp" type="datetime-local" id="ed"></div>
    <div class="iw"><label class="il">Locatie</label><input class="inp" id="el" placeholder="bijv. Caf√© De Kroon"></div>
    <div class="iw"><label class="il">Beschrijving</label><textarea class="inp" id="edesc" rows="3" placeholder="Meer info..."></textarea></div>
    <div style="display:flex;gap:10px;margin-top:6px">
      <button class="btn bg_" onclick="closeModal('mo-ev')">Annuleren</button>
      <button class="btn ba" style="flex:1" onclick="createEvent()">Aanmaken üéâ</button>
    </div>
  </div>
</div>

<!-- NEW GROUP -->
<div class="ov" id="mo-grp">
  <div class="sh">
    <div class="hn"></div>
    <div class="mt">üë• Nieuwe groepschat</div>
    <div class="iw"><label class="il">Naam van de groep</label><input class="inp" id="gn" placeholder="bijv. Vrijdagbende üç∫"></div>
    <div class="iw">
      <label class="il">Leden toevoegen</label>
      <div class="mpc" id="gmc"></div>
      <div class="fpl" id="gfp"></div>
    </div>
    <div style="display:flex;gap:10px;margin-top:10px">
      <button class="btn bg_" onclick="closeModal('mo-grp')">Annuleren</button>
      <button class="btn ba" style="flex:1" onclick="createGroup()">Groep aanmaken</button>
    </div>
  </div>
</div>

<!-- PROFILE -->
<div class="ov" id="mo-prof">
  <div class="sh">
    <div class="hn"></div>
    <div class="ph">
      <div class="pa" id="pav">?</div>
      <div><div class="pn" id="pnm"></div><div class="pe" id="pem"></div></div>
    </div>
    <div class="dv"></div>
    <button class="btn br_ bw" onclick="doLogout()">Uitloggen</button>
  </div>
</div>

<!-- PHOTO VIEWER -->
<div class="ov center" id="mo-ph" onclick="closeModal('mo-ph')">
  <img id="pbig" src="" style="max-width:100%;max-height:80dvh;border-radius:var(--rl);box-shadow:0 20px 60px rgba(0,0,0,.8)">
</div>

<div class="toast" id="toast"></div>

<script type="module">
import{initializeApp}from"https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";
import{getAuth,createUserWithEmailAndPassword,signInWithEmailAndPassword,signOut,onAuthStateChanged,updateProfile,setPersistence,browserLocalPersistence}from"https://www.gstatic.com/firebasejs/11.0.0/firebase-auth.js";
import{getFirestore,collection,addDoc,getDocs,onSnapshot,query,orderBy,serverTimestamp,doc,setDoc,getDoc,updateDoc,where,deleteDoc}from"https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";

const app=initializeApp({apiKey:"AIzaSyB79_lT_UeSj3WZgGUjl6FJsugK-Oa-dFM",authDomain:"drinking-ap.firebaseapp.com",projectId:"drinking-ap",storageBucket:"drinking-ap.firebasestorage.app",messagingSenderId:"869345427783",appId:"1:869345427783:web:4db013a00017054e2c4c62"});
const auth=getAuth(app),db=getFirestore(app);
setPersistence(auth,browserLocalPersistence).catch(()=>{});

let me=null,myFriends=[],activeRoomId=null,unsubRoom=null,unsubEvs=null,unsubRooms=null,selMembers=[];

const $=id=>document.getElementById(id);
const toast=(msg,d=2500)=>{const t=$('toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),d)};
const ini=n=>n?n.trim().split(' ').map(w=>w[0]).join('').toUpperCase().slice(0,2):'?';
const ftm=ts=>{if(!ts)return'';const d=ts.toDate?ts.toDate():new Date(ts);return d.toLocaleTimeString('nl-BE',{hour:'2-digit',minute:'2-digit'})};
const fdt=ts=>{if(!ts)return'';const d=ts.toDate?ts.toDate():new Date(ts);return d.toLocaleDateString('nl-BE',{weekday:'long',day:'numeric',month:'long',hour:'2-digit',minute:'2-digit'})};

window.closeModal=id=>$(id).classList.remove('open');
const openModal=id=>$(id).classList.add('open');
window.openProfile=()=>openModal('mo-prof');
window.openCreateEvent=()=>{const d=new Date(Date.now()+3600000);d.setSeconds(0,0);$('ed').value=d.toISOString().slice(0,16);openModal('mo-ev')};
window.openNewGroup=()=>{selMembers=[];renderGP();$('gn').value='';openModal('mo-grp')};
document.querySelectorAll('.ov').forEach(o=>o.addEventListener('click',e=>{if(e.target===o&&o.id!=='mo-ph')o.classList.remove('open')}));

window.authTab=tab=>{
  document.querySelectorAll('.sb').forEach((b,i)=>b.classList.toggle('on',(i===0&&tab==='login')||(i===1&&tab==='register')));
  $('ap-login').style.display=tab==='login'?'block':'none';
  $('ap-reg').style.display=tab==='register'?'block':'none';
};
const showErr=(id,msg)=>{const e=$(id);e.textContent=msg;e.style.display='block'};
const hideErr=id=>$(id).style.display='none';

window.doLogin=async()=>{
  hideErr('li-er');
  const em=$('li-em').value.trim(),pw=$('li-pw').value;
  if(!em||!pw){showErr('li-er','Vul alle velden in.');return}
  try{await signInWithEmailAndPassword(auth,em,pw)}
  catch(e){showErr('li-er',e.code==='auth/invalid-credential'?'Fout e-mail of wachtwoord.':'Fout: '+e.message)}
};
window.doRegister=async()=>{
  hideErr('rg-er');
  const nm=$('rg-nm').value.trim(),em=$('rg-em').value.trim(),pw=$('rg-pw').value;
  if(!nm||!em||!pw){showErr('rg-er','Vul alle velden in.');return}
  if(pw.length<6){showErr('rg-er','Wachtwoord minimaal 6 tekens.');return}
  try{
    const c=await createUserWithEmailAndPassword(auth,em,pw);
    await updateProfile(c.user,{displayName:nm});
    await setDoc(doc(db,'users',c.user.uid),{name:nm,email:em.toLowerCase(),uid:c.user.uid,createdAt:serverTimestamp()});
  }catch(e){showErr('rg-er',e.code==='auth/email-already-in-use'?'E-mailadres al in gebruik.':'Fout: '+e.message)}
};
window.doLogout=async()=>{await signOut(auth);closeModal('mo-prof')};

onAuthStateChanged(auth,async user=>{
  $('ld').style.display='none';
  if(user){
    me=user;
    const i=ini(user.displayName);
    $('hav').textContent=i;$('pav').textContent=i;
    $('pnm').textContent=user.displayName||'';$('pem').textContent=user.email||'';
    $('greet').textContent=`Hey ${user.displayName?.split(' ')[0]||'daar'} üëã`;
    $('fab').classList.add('show');
    $('sa').classList.remove('on');$('sap').classList.add('on');
    await loadFriends();startEvs();startRooms();loadLoc();loadPhotos();
  }else{
    me=null;myFriends=[];
    $('sap').classList.remove('on');$('sa').classList.add('on');$('fab').classList.remove('show');
    [unsubRoom,unsubEvs,unsubRooms].forEach(u=>u&&u());
  }
});

window.goTab=tab=>{
  document.querySelectorAll('.tv').forEach(v=>v.classList.remove('on'));
  document.querySelectorAll('.nb').forEach(b=>b.classList.remove('on'));
  $('tv-'+tab).classList.add('on');$('nb-'+tab).classList.add('on');
  $('fab').classList.toggle('show',tab==='home');
  if(tab==='chat'){$('cbd').style.display='none';closeRoom()}
  if(tab==='friends')loadFriends();
  if(tab==='photos')loadPhotos();
};

/* EVENTS */
window.createEvent=async()=>{
  const nm=$('en').value.trim(),dv=$('ed').value,lc=$('el').value.trim(),ds=$('edesc').value.trim();
  if(!nm){toast('‚ùå Vul een naam in!');return}
  if(!dv){toast('‚ùå Kies een datum!');return}
  try{
    await addDoc(collection(db,'events'),{name:nm,date:new Date(dv),location:lc,description:ds,createdBy:me.uid,createdByName:me.displayName,rsvps:{},createdAt:serverTimestamp()});
    closeModal('mo-ev');$('en').value='';$('el').value='';$('edesc').value='';
    toast('üéâ Event aangemaakt!');
  }catch(e){toast('Fout: '+e.message)}
};
function startEvs(){
  if(unsubEvs)unsubEvs();
  unsubEvs=onSnapshot(query(collection(db,'events'),orderBy('date','asc')),snap=>{
    const evs=[];snap.forEach(d=>evs.push({id:d.id,...d.data()}));renderEvs(evs);
  },()=>{});
}
function renderEvs(evs){
  const c=$('evl');
  if(!evs.length){c.innerHTML='<div class="empty"><div class="ei">üç∫</div><p>Nog geen events.<br>Tik + om er een aan te maken!</p></div>';return}
  c.innerHTML=evs.map(ev=>{
    const r=ev.rsvps||{},my=r[me?.uid]||'',yc=Object.values(r).filter(x=>x==='yes').length,ds=ev.date?.toDate?fdt(ev.date):'';
    return`<div class="evc"><div class="evh"><div class="evn">${ev.name}</div><div class="evcs">${ds?`<span class="evch">üìÖ ${ds}</span>`:''} ${ev.location?`<span class="evch">üìç ${ev.location}</span>`:''}<span class="evch">‚úÖ ${yc} komen</span></div></div><div class="evb">${ev.description?`<div class="evd">${ev.description}</div>`:''}<div class="rvw"><button class="rv yes ${my==='yes'?'on':''}" onclick="rsvp('${ev.id}','yes')">‚úÖ Ik kom</button><button class="rv maybe ${my==='maybe'?'on':''}" onclick="rsvp('${ev.id}','maybe')">ü§î Misschien</button><button class="rv no ${my==='no'?'on':''}" onclick="rsvp('${ev.id}','no')">‚ùå Kan niet</button></div><div class="evf"><span class="evby">Door ${ev.createdByName||'onbekend'}</span></div></div></div>`;
  }).join('');
}
window.rsvp=async(id,status)=>{
  if(!me)return;
  try{await updateDoc(doc(db,'events',id),{[`rsvps.${me.uid}`]:status});toast(status==='yes'?'‚úÖ Je bent erbij!':status==='maybe'?'ü§î Misschien...':'‚ùå Jammer!')}
  catch(e){toast('Fout: '+e.message)}
};

/* CHAT ROOMS */
function startRooms(){
  if(unsubRooms)unsubRooms();
  unsubRooms=onSnapshot(query(collection(db,'rooms'),where('members','array-contains',me.uid),orderBy('lastAt','desc')),snap=>{
    const rooms=[];snap.forEach(d=>rooms.push({id:d.id,...d.data()}));renderRooms(rooms);
  },()=>{});
}
function renderRooms(rooms){
  const c=$('crl');
  if(!rooms.length){c.innerHTML='<div class="empty" style="padding:30px 10px"><div class="ei" style="font-size:2rem">üí¨</div><p>Voeg vrienden toe<br>om te chatten!</p></div>';return}
  c.innerHTML=rooms.map(r=>{
    const isG=r.type==='group',nm=r.name||(isG?'Groep':'DM'),prev=r.lastMsg||'Nog geen berichten',tm=r.lastAt?ftm(r.lastAt):'';
    const icon=isG?`<div class="cricon">üë•</div>`:`<div class="cricon dm">${ini(r.name||'?')}</div>`;
    const snm=nm.replace(/'/g,"\\'"),ssub=(r.memberNames||[]).join(', ').replace(/'/g,"\\'");
    return`<div class="cri ${r.id===activeRoomId?'active':''}" onclick="openRoom('${r.id}','${snm}','${ssub}')">${icon}<div class="crinfo"><div class="crn">${nm}</div><div class="crp">${prev}</div></div><div class="crm"><div class="crt">${tm}</div></div></div>`;
  }).join('');
}
window.openRoom=(id,nm,sub)=>{
  activeRoomId=id;$('rn').textContent=nm;$('rs').textContent=sub||'';$('cmsgs').innerHTML='';
  $('crpp').classList.add('open');listenRoom(id);
};
window.closeRoom=()=>{activeRoomId=null;$('crpp').classList.remove('open');if(unsubRoom){unsubRoom();unsubRoom=null}};
function listenRoom(rid){
  if(unsubRoom){unsubRoom();unsubRoom=null}
  unsubRoom=onSnapshot(query(collection(db,'rooms',rid,'messages'),orderBy('createdAt','asc')),snap=>{
    const msgs=[];snap.forEach(d=>msgs.push({id:d.id,...d.data()}));renderMsgs(msgs);
  },()=>{});
}
function renderMsgs(msgs){
  const c=$('cmsgs');
  if(!msgs.length){c.innerHTML='<div class="empty" style="margin:auto;padding:40px 20px"><div class="ei" style="font-size:2rem">üí¨</div><p>Begin de conversatie!</p></div>';return}
  c.innerHTML=msgs.map(m=>{const iM=m.uid===me?.uid;return`<div class="mr ${iM?'me':''}">
    ${!iM?`<div class="ma">${ini(m.name)}</div>`:''}
    <div class="mc">${!iM?`<div class="ms">${m.name}</div>`:''}<div class="mb">${m.text}</div><div class="mti">${ftm(m.createdAt)}</div></div></div>`}).join('');
  c.scrollTop=c.scrollHeight;
}
window.sendMsg=async()=>{
  if(!activeRoomId||!me)return;
  const inp=$('mi'),tx=inp.value.trim();if(!tx)return;inp.value='';
  try{
    await addDoc(collection(db,'rooms',activeRoomId,'messages'),{text:tx,uid:me.uid,name:me.displayName||'Onbekend',createdAt:serverTimestamp()});
    await updateDoc(doc(db,'rooms',activeRoomId),{lastMsg:tx,lastAt:serverTimestamp()});
  }catch(e){toast('Fout: '+e.message)}
};
async function ensureDM(fuid,fnm){
  const snap=await getDocs(query(collection(db,'rooms'),where('type','==','dm'),where('members','array-contains',me.uid)));
  for(const d of snap.docs){if(d.data().members.includes(fuid))return d.id}
  const r=await addDoc(collection(db,'rooms'),{type:'dm',name:fnm,members:[me.uid,fuid],memberNames:[me.displayName||'',fnm||''],lastMsg:'',lastAt:serverTimestamp(),createdAt:serverTimestamp()});
  return r.id;
}
function renderGP(){
  const pk=$('gfp'),ch=$('gmc');pk.innerHTML='';ch.innerHTML='';
  if(!myFriends.length){pk.innerHTML='<p style="font-size:.82rem;color:var(--tx2);padding:8px 0">Voeg eerst vrienden toe!</p>';return}
  myFriends.forEach(f=>{
    const sel=selMembers.includes(f.uid),div=document.createElement('div');
    div.className=`fpi${sel?' sel':''}`;
    div.innerHTML=`<div class="fpia">${ini(f.name)}</div><span class="fpinm">${f.name}</span>${sel?'<span class="fpck">‚úì</span>':''}`;
    div.onclick=()=>{selMembers=sel?selMembers.filter(u=>u!==f.uid):[...selMembers,f.uid];renderGP()};
    pk.appendChild(div);
  });
  selMembers.forEach(uid=>{
    const f=myFriends.find(x=>x.uid===uid);if(!f)return;
    const chip=document.createElement('span');chip.className='mch';
    chip.innerHTML=`${f.name}<span style="opacity:.7;margin-left:2px">‚úï</span>`;
    chip.onclick=()=>{selMembers=selMembers.filter(u=>u!==uid);renderGP()};
    ch.appendChild(chip);
  });
}
window.createGroup=async()=>{
  const nm=$('gn').value.trim();
  if(!nm){toast('Geef de groep een naam!');return}
  if(!selMembers.length){toast('Voeg minstens √©√©n lid toe!');return}
  const members=[me.uid,...selMembers],memberNames=[me.displayName||'',...selMembers.map(uid=>myFriends.find(f=>f.uid===uid)?.name||'')];
  try{
    await addDoc(collection(db,'rooms'),{type:'group',name:nm,members,memberNames,lastMsg:'',lastAt:serverTimestamp(),createdAt:serverTimestamp(),createdBy:me.uid});
    closeModal('mo-grp');toast('üë• Groep aangemaakt!');
  }catch(e){toast('Fout: '+e.message)}
};

/* FRIENDS */
async function loadFriends(){
  if(!me)return;myFriends=[];
  try{
    const[s1,s2]=await Promise.all([
      getDocs(query(collection(db,'friendRequests'),where('from','==',me.uid),where('status','==','accepted'))),
      getDocs(query(collection(db,'friendRequests'),where('to','==',me.uid),where('status','==','accepted')))
    ]);
    s1.forEach(d=>{const x=d.data();myFriends.push({uid:x.to,name:x.toName,email:x.toEmail,reqId:d.id})});
    s2.forEach(d=>{const x=d.data();myFriends.push({uid:x.from,name:x.fromName,email:x.fromEmail,reqId:d.id})});
    renderFriends();loadReqs();
  }catch(e){}
}
function renderFriends(){
  const c=$('frl');
  if(!myFriends.length){c.innerHTML='<div class="empty"><div class="ei">üë•</div><p>Nog geen vrienden.<br>Zoek iemand op via e-mail!</p></div>';return}
  c.innerHTML=myFriends.map(f=>`<div class="fri"><div class="fra">${ini(f.name)}</div><div class="frin"><div class="frn">${f.name}</div><div class="fre">${f.email}</div></div><div class="frac"><button class="btn bg_ bxs" onclick="openDM('${f.uid}','${f.name.replace(/'/g,"\\'")}')">üí¨</button><button class="btn br_ bxs" onclick="unfriend('${f.reqId}','${f.name.replace(/'/g,"\\'")}')">‚úï</button></div></div>`).join('');
}
async function loadReqs(){
  if(!me)return;
  try{
    const snap=await getDocs(query(collection(db,'friendRequests'),where('to','==',me.uid),where('status','==','pending')));
    const sec=$('frreq'),list=$('frrl');
    if(snap.empty){sec.style.display='none';return}
    sec.style.display='block';list.innerHTML='';
    snap.forEach(d=>{
      const x=d.data(),div=document.createElement('div');div.className='fri';
      div.innerHTML=`<div class="fra">${ini(x.fromName)}</div><div class="frin"><div class="frn">${x.fromName}</div><div class="fre">${x.fromEmail}</div></div><div class="frac"><button class="btn bgn bxs" onclick="acceptFr('${d.id}','${x.from}','${x.fromName.replace(/'/g,"\\'")}')">‚úì</button><button class="btn br_ bxs" onclick="declineFr('${d.id}')">‚úï</button></div>`;
      list.appendChild(div);
    });
  }catch(e){}
}
window.searchFriend=async()=>{
  const em=$('frs').value.trim().toLowerCase();
  if(!em){toast('Vul een e-mailadres in!');return}
  if(em===me.email?.toLowerCase()){toast('Dat ben jijzelf üòÑ');return}
  if(myFriends.find(f=>f.email.toLowerCase()===em)){toast('Je bent al vrienden!');return}
  try{
    const ex=await getDocs(query(collection(db,'friendRequests'),where('from','==',me.uid),where('toEmail','==',em),where('status','==','pending')));
    if(!ex.empty){toast('Je hebt al een verzoek gestuurd!');return}
    const q=await getDocs(query(collection(db,'users'),where('email','==',em)));
    if(q.empty){toast('Geen gebruiker gevonden!');return}
    const fd=q.docs[0],fx=fd.data();
    const rev=await getDocs(query(collection(db,'friendRequests'),where('from','==',fd.id),where('to','==',me.uid),where('status','==','pending')));
    if(!rev.empty){toast('Deze persoon heeft jou al een verzoek gestuurd!');return}
    await setDoc(doc(db,'friendRequests',`${me.uid}_${fd.id}`),{from:me.uid,fromName:me.displayName,fromEmail:me.email,to:fd.id,toName:fx.name,toEmail:fx.email,status:'pending',createdAt:serverTimestamp()});
    $('frs').value='';toast(`‚úâÔ∏è Verzoek verstuurd naar ${fx.name}!`);
  }catch(e){toast('Fout: '+e.message)}
};
window.acceptFr=async(rid,fuid,fnm)=>{
  try{await updateDoc(doc(db,'friendRequests',rid),{status:'accepted'});toast(`üéâ ${fnm} toegevoegd!`);await loadFriends();await ensureDM(fuid,fnm)}
  catch(e){toast('Fout: '+e.message)}
};
window.declineFr=async rid=>{
  try{await updateDoc(doc(db,'friendRequests',rid),{status:'declined'});loadFriends()}catch(e){}
};
window.unfriend=async(rid,nm)=>{
  if(!confirm(`Wil je ${nm} verwijderen als vriend?`))return;
  try{await updateDoc(doc(db,'friendRequests',rid),{status:'removed'});toast(`${nm} verwijderd.`);loadFriends()}
  catch(e){toast('Fout: '+e.message)}
};
window.openDM=async(uid,nm)=>{goTab('chat');const id=await ensureDM(uid,nm);setTimeout(()=>openRoom(id,nm,'Priv√©gesprek'),300)};

/* MAP */
window.saveLoc=async()=>{
  const nm=$('ln').value.trim(),lat=parseFloat($('ll').value)||51.0259,lng=parseFloat($('llg').value)||4.4776;
  if(!nm){toast('Vul een naam in!');return}
  try{await setDoc(doc(db,'settings','meetingpoint'),{name:nm,lat,lng,updatedBy:me.displayName,updatedAt:serverTimestamp()});toast('üìç Locatie opgeslagen!');loadLoc()}
  catch(e){toast('Fout: '+e.message)}
};
async function loadLoc(){
  try{
    const snap=await getDoc(doc(db,'settings','meetingpoint'));if(!snap.exists())return;
    const d=snap.data();
    $('mf').innerHTML=`<iframe src="https://www.openstreetmap.org/export/embed.html?bbox=${d.lng-.01},${d.lat-.01},${d.lng+.01},${d.lat+.01}&layer=mapnik&marker=${d.lat},${d.lng}" style="width:100%;height:100%;border:0;border-radius:var(--rl)" loading="lazy"></iframe>`;
    $('sln').textContent=d.name;$('slm').textContent=`${d.lat?.toFixed(4)}, ${d.lng?.toFixed(4)} ‚Äî door ${d.updatedBy||'onbekend'}`;
    $('slg').href=`https://maps.google.com/?q=${d.lat},${d.lng}`;$('slc').style.display='block';
  }catch(e){}
}

/* PHOTOS */
window.uploadPhoto=inp=>{
  const file=inp.files[0];if(!file)return;toast('‚è≥ Uploaden...');
  const r=new FileReader();
  r.onload=async e=>{
    try{await addDoc(collection(db,'photos'),{url:e.target.result,uploadedBy:me.displayName,uid:me.uid,createdAt:serverTimestamp()});toast('üì∏ Foto gedeeld!');loadPhotos()}
    catch(err){toast('Fout: '+err.message)}
  };
  r.readAsDataURL(file);inp.value='';
};
async function loadPhotos(){
  if(!me)return;
  try{
    const snap=await getDocs(query(collection(db,'photos'),orderBy('createdAt','desc')));
    const g=$('pgr'),em=$('phem');
    if(snap.empty){g.innerHTML='';em.style.display='block';return}
    em.style.display='none';g.innerHTML='';
    snap.forEach(d=>{
      const x=d.data(),cell=document.createElement('div');cell.className='pc';
      const img=document.createElement('img');img.src=x.url;img.alt='';img.loading='lazy';
      img.onclick=()=>{$('pbig').src=x.url;$('mo-ph').classList.add('open')};
      cell.appendChild(img);g.appendChild(cell);
    });
  }catch(e){}
}
</script>
</body>
</html>
